@startuml
'https://plantuml.com/sequence-diagram

!theme cerulean-outline

skinparam backgroundColor #EEF2F7
skinparam titleBorderRoundCorner 15
skinparam titleBorderThickness 2
skinparam titleBorderColor #2471A3
skinparam titleFontColor #2471A3
skinparam sequenceArrowThickness 2
skinparam defaultTextAlignment center
skinparam sequenceParticipantBorderThickness 2
skinparam sequenceParticipantFontColor #EEF2F7
skinparam sequenceLifeLineBorderColor #2471A3
skinparam sequenceLifeLineBorderThickness 1.5
skinparam sequenceParticipantBackgroundColor #2471A3
skinparam sequenceParticipantBorderColor #2471A3
skinparam CollectionsBorderColor #000000
skinparam CollectionsBackgroundColor #2471A3
skinparam CollectionsFontColor #EEF2F7
skinparam ArrowColor #2471A3
skinparam ArrowThickness 2
skinparam sequenceLifeLineBackgroundColor #D0D3D4

group Outdoor logs
activate EnvTempService
EnvTempService -> RoomRepository: findAllByHouseIdAndOutdoorIndoor(room.getHouseId(), \nOutdoorIndoor.OUTDOOR)
activate RoomRepository
RoomRepository --> EnvTempService: outdoorRooms: Iterable<Room>
deactivate RoomRepository

group findAllDevicesInARoomList(outdoorRooms: Iterable<Room>)
loop outdoorRooms.size
EnvTempService -> DeviceRepository: findAllByRoomId(roomId.id: Long)
activate DeviceRepository
DeviceRepository --> EnvTempService: devices: Iterable<Device>
deactivate DeviceRepository
loop devices.size
EnvTempService -> EnvTempService: devicesToReturn.add(device)
end

end

end

group findAllTemperatureSensorsInAListOfDevices(devices: Iterable<Device>)
loop devices.size
EnvTempService -> EnvTempService: findAllTemperatureSensorByDeviceId(\ndevice.identity().id): sensorsToReturn.addAll(sensors)
note right: Reusing the \n"findAllTemperatureSensorByDeviceId(deviceId: DeviceId)"\n method previously written to get sensors: List<Sensor>
end

end

EnvTempService -> EnvTempService: getLogsInAGivenTimePeriod(\noutdoorSensors: Iterable<Sensor>, \nstartDate: ZonedDateTime, \nendDate: ZonedDateTime)
note right: Reusing the \n"getLogsInAGivenTimePeriod(...)"\n method previously written to get \noutdoorLogs: List<SensorActivityLog>
end
@enduml